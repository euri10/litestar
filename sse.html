<!DOCTYPE html>
<html>
  <body>
    <h2>Server-Sent Events</h2>
    <div id="output"></div>
    <script>
      if (typeof EventSource !== "undefined") {
        var eventSource = new EventSource("http://localhost:8000/testme");
        eventSource.onmessage = function (event) {
          console.log(event.data);
          document.getElementById("output").innerHTML += event.data + "<br>";
        };


        eventSource.addEventListener("task_progress", (ev) => {
            console.log(event.data);
            document.getElementById("output").innerHTML += event.data + "<br>";
          });

        eventSource.addEventListener("endx", (ev) => {
          console.log("endx arrived");
          document.getElementById("output").innerHTML += "endx arrived" + "<br>";
          eventSource.close();
        });

        eventSource.addEventListener("error", (err) => {
            console.error(err)
            document.getElementById("output").innerHTML += "error: "+ err + "<br>";
        })
      } else {
        document.getElementById("output").innerHTML =
          // If browser does not support SSE
          "Sorry, the browser does not support SSE";
      }
    </script>
  </body>
</html>